<?php/** * @package Ui_D3 *//** * Easy to use d3 timeline. * Requirements: jquery datepicker plugin, d3 library and timelinegrid plugin must be included in your view  * */class Ui_D3_Timeline{		/***	 * an array of html attributes for the div container	 * @var array;	 */	public $atts = array();		/**	 * the Ui_D3_Timeline_Point collection	 * @var array;	 */	public $data;		/**	 * objct of d3 CONTAINER properties for width and height	 */	public $bounds;		/**	 * set to false via preventAutostart	 * @var boolean	 */	protected $_autostart = true;		/**	 * class constructor	 * Take an array "data" as argument	 * @param data - an array of Ui_D3_Timeline_Point, e.g array( new Ui_D3_Timeline_Point( "22.10.2011"), new Ui_D3_Timeline_Point( "28.11.2011") ... )	 * @param dateFormat - usually, "dd.mm.yy", format according to  $.datepicker.parseDate jquery function	 */	public function __construct( $data , $dateFormat="dd.mm.yy", $bounds = array("width"=>1000, "height"=>200),$atts=array("id"=>"ui-d3-timeline","class"=>"timeline item-header grid_24 alpha omega") ){		$this->atts = $atts;		$this->bounds =(object) $bounds;		$this->dateFormat = $dateFormat;		$this->data = $data;		echo "built";	}			public function preventAutostart(){		$this->_autostart = false;	}		/**	 * simply cast __toString() this to output the visualization!	 */	public function __toString(){				return '		<!-- automatic javascript output from Ui_D3_Timeline php class -->				<div '.iatts( $this->atts ).'>			<div id="'.$this->atts[ 'id' ].'-chart"></div>			<script type="text/javascript">			var d3_timeline = function(){				var $this = this;				this.data = '.json_encode( $this->data ).';								// understand data objects								$.map( $this.data, function( obj ){					obj.t = $.datepicker.parseDate(  "'.$this->dateFormat.'", obj.t ).getTime(); // change the value of each x					return obj;				});								this.update = function( settings ){					$this.init();				}								this.init = function(){					var tmin = d3.min( $this.data, function( d ) {								return d.t; // reduce data object to single number							});					var tmax = d3.max( $this.data, function( d ) {								return d.t;							});					var ymin = d3.min( $this.data, function( d ){								return d.y;							})					var ymax = d3.max( $this.data, function( d ){								return d.y;							});					// transformation for x and y					var tx = d3.scale.linear().domain([							tmin,							tmax						]).range([0, '.$this->bounds->width.']); // range according to real width /height											var ty = d3.scale.log().domain([							ymin,							ymax						]).range([0, '.$this->bounds->height.']);															var tt = new TimelineGrid({						dates:{							min: new Date( tmin ) ,							max: new Date( tmax) 							},						target: $("#ui-timeline-grid")					});										/*					.append("svg:rect")					4     .attr("x", function(d, i) { return x(i) - .5; })					5     .attr("y", function(d) { return h - y(d.value) - .5; })					6     .attr("width", w)					7     .attr("height", function(d) { return y(d.value); });					*/					// transform data to timestamp										// [{"y": 13, "x": 1, "title": "go"}, {"y": 13, "x": 2, "title": "go"}					var bez = d3.select("#'.$this->atts[ 'id' ].'-chart")						.append("svg:svg")						.attr("width",  '.$this->bounds->width.')						.attr("height", '.$this->bounds->height.')						.attr("style","background:rgba(233,233,233,.5);border: 1px solid #EDEDED;margin:0px 10px" );											bez.selectAll("path")						.data( $this.data )						.enter().append("svg:rect")						.attr("x", function( d ){return tx(d.t)})						.attr("y", function( d ){ return '.$this->bounds->height.' - Math.max(1,ty(d.y)) })						.attr("height", function( d ){ return Math.max(3,ty(d.y))})						.attr("width", 3 )						.attr("class", "tip-helper date_filter")						.attr("href", function( d ){return d.href})						.attr("title", function( d ){return d.title}).style("fill", "#000" )																			}								this.init();			};						$(window).load(function(){				// execute				d3_timeline();			});			</script>			<div id="ui-timeline-grid"></div>		</div>		';	}}?>